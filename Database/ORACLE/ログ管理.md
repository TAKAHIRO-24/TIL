# 自動診断リポジトリ（ADR : Automatic Diagnostic Repository）

- ログを集中管理する機能。
- `DIAGNOSTIC_DEST`初期化パラメータに自動診断リポジトリのベースディレクトリ（`ADRベース`）を設定し、このディレクトリ配下にある`ADRホーム`にログファイルを格納する。
- `DIAGNOSTIC_DEST`初期化パラメータに設定がない場合は、`ORACLE_BASE`環境変数の値または`<ORACLE_HOME>/log`が使用され、ここがADRベースとなる。
- 自動診断リポジトリはあるディレクトリにあるファイルの集合体なので参照するのにデータベースが起動している必要はない。
- ADRベース配下に、製品ごとのディレクトリをもつ。
- 製品のインスタンス（プレセス）ごとにADRホームが決定される。  
  Oracle Databaseの場合、ADRホームは`<ADRベース>/diag/rdbms/<データベース名>/<ORACLE_SID>`となる。

```
ADRベース //`DIAGNOSTIC_DEST`により決定
├─diag
    ├─asm       //ASM(Automatic Storage Management)関連のログファイル
    ├─clients   //Oracle Clinet関連のログファイルを格納
    ├─tnslsnr   //リスナー関連のログファイルを格納
    ├─rdbms     //Oracle Database関連のログファイルを格納
        ├─<データベース名>
            ├─<ORACLE_SID>    //OracleインスタンスのADRホーム
                ├─alert           //XML形式のアラートログを格納
                ├─cdump           //コアダンプを格納
                ├─hm              //ヘルスモニターの結果を格納
                ├─incident        //インシデントダンプを格納
                ├─incpkg          //インシデントパッケージを格納
                ├─ir              //データリカバリアドバイザの修復スクリプトを格納
                ├─lck
                ├─log
                ├─metadata
                ├─metadata_dgif
                ├─metadata_pv
                ├─stage
                ├─sweep
                └─trace           //テキスト形式のアラートログ、トレースファイルを格納
```

# アラートログ

インスタンスで発生した致命的なエラーや起動・終了などの管理情報、インスタンスの構成変更など、多くの情報がテキスト形式で出力される。

## 出力される情報
- インスタンスの起動・終了処理の状況
- デフォルト値以外の値が設定された初期化パラメータの値
- 発生したすべての内部エラー（ORA-00600, ORA-07445）
- ブロック障害エラー（ORA-01578）
- デッドロックエラー（ORA-00060）
- その他の重大なエラー
- 実行した管理コマンドとその実行結果
  - CREATE
  - ALTER
  - DROP DATABASE
  - TABLESPACE
  - ARCHIVE LOG出力
  - リカバリ処理
- ジョブの実行エラー

## 出力先
一つのインスタンスに一つ存在し、インスタンスのADRホームのtraceディレクトリに`alert_<ORACLE_SID>.log`というファイル名で出力される。

# プロセストレースファイル
サーバープロセスやバックグラウンドプロセスなどの各プロセスが出力した情報がテキスト形式で出力されている。

## 出力先
ADRホームのtraceディレクトリに`<インスタンスSID>_<プロセス名>_<OSプロセス番号>.trc`というファイル名で出力される。

# インシデントダンプファイル
致命的なエラーが発生すると、アラートログにエラー番号が出力されるのと同時に、インシデントダンプファイルにエラー情報が出力される。  
インシデント（発生した障害）ごとにインシデントIDが付与され、あるインシデントに関する診断情報は、そのインシデントに対応する`インシデントディレクトリ`に出力される。  

## 出力先
インシデントディレクトリは、インスタンスのADRホームのincidentディレクトリ内に作成されたサブディレクトリ`incdir_<インシデント番号>`。  
インシデントダンプファイルは、対応するインシデントのインシデントディレクトリ内に、`<インスタンスSID>_<プロセス名>_<OSプロセス番号>_i<インシデント番号>.trc`というファイル名で出力される。