# メモリ領域
## データベースバッファキャッシュ
## REDOログバッファ
## 共有プール
- [共有プール・バッファキャッシュのクリア](https://kanamelogic.com/20160206/memory-flush/)
### 1. 概要
性能向上のために様々な情報をキャッシュするメモリ領域。  
主な対象は以下の通り。
- 解析済みSQLの情報（ライブラリキャッシュ）
  同一のSQLを実行する場合、共有プールに格納されている解析済みSQLの情報を使用することで、SQLを実行するまでの時間を短縮したり、データベースサーバーにかかる負荷を減らしたりできる。
- データディクショナリの情報（ディクショナリキャッシュ）
  データディクショナリ（ユーザー情報やテーブルスペース情報、順序情報等）を保持。

上記の仕組みのために、SQLのパフォーマンステストを実行する際は、各種メモリをクリアしないと、本来よりも短い処理時間・応答時間となる可能性がある。

### 2. メモリクリア
メモリをクリアするには以下のSQLを実行する。  
※メモリクリアだけであればOracleの再起動でも可。
```sql
--共有プールのクリア
--SQLの解析結果や実行計画をクリアする
ALTER SYSTEM FLUSH SHARED_POOL;

--バッファキャッシュのクリア
--データファイルから読み取られたデータをクリアする
ALTER SYSTEM FLUSH BUFFER_CACHE;
```

### 3. 注意点
- 共有プールのクリアは順序（シーケンス）のキャッシュもクリアされるため、順序（シーケンス）を利用して採番している項目に欠番が発生する。  
  - [なぜ、シーケンス（順序）の番号が飛ぶのか](https://www.bnote.net/oracle/sequence_lost.html)
  - `CREATE SEQUENCE`時の`CACHE`で指定する値（デフォルトは20）によって、シーケンスは実際に発番されるより前に事前に値を取得して共有プールに保持する。DB再起動や`ALTER SYSTEM FLUSH`で共有プールがクリアされると、事前に発番されて共有プールにキャッシュされていた分が欠番となる。
- バッファキャッシュのクリアは、並行して問合せが行われている場合に正しい結果を取得できなくなることがある。

## PGA

## バックグラウンドプロセス
|プロセス名|略称|詳細|
|:-:|:-:|:-|
|データベースライター|DBWn|チェックポイント発生時にデータベースバッファキャッシュ内の変更済みブロックをデータファイルに書き込む。|
|ログライター|LGWR|REDOログバッファのREDOデータ（変更履歴情報）を、commit時やログバッファの空き容量が不足した際にREDOログファイルに書き出す。|
|チェックポイント|CKPT|・DBWnに対して、データベースバッファキャッシュ内の変更済みブロックをデータファイルに書き込む指示をだす（チェックポイント）。<br>・制御ファイルにチェックポイント情報を書き込む。|
|システムモニター|SMON|・インスタンスが異常終了した場合、次回インスタンス起動時にデータベースファイルの整合性を復旧する処理を実行。<br>・未使用の一時セグメントを解放する。|
|プロセスモニター|PMON|・プロセスが異常終了した場合、そのプロセスが使用していた様々なデータやリソースのクリーンアップを実行。<br>・アイドル時間を超えたセッションを検知し、強制終了などの対処を支持する。|
|管理モニター|MMON|AWRスナップショットなど、性能分析で使用される様々な統計情報を定期収集する。|
|アーカイバ|ARCn|ログスイッチ発生後、REDOログファイルのREDOデータをアーカイブログファイルとしてコピーする。|
|リスナー登録プロセス|LREG|インスタンスに関する情報をリスナーに登録する。|