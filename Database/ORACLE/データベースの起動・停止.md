# データベースの起動・停止

## 起動

`SYSDBA権限`が付与されたORACLEユーザーで接続し、SQL*Plusから`STARTUPコマンド`を実行する。

![image](https://github.com/TAKAHIRO-24/TIL/assets/85177462/166c27d6-52b9-4511-b855-fc0967425b32)

### 実行可能な処理
|起動状態|実行できる処理|
|:-:|:-|
|SHUTDOWN状態|管理ユーザーでの接続|
|NOMOUNT状態|管理ユーザーでの接続|
||データベースの作成（CREATE DATABASE）|
||制御ファイルの作成（CREATE CONTROLFILE）|
|MOUNT状態|管理ユーザーでの接続|
||アーカイブログモードへの変更（ALTER DATABASE ARCHIVELOG）|
||データベース全体のリカバリ処理|
|OPEN状態|管理・一般ユーザーでの接続|
|||

## 停止
`SYSDBA権限`等が付与されたORACLEユーザーで接続し、SQL*Plusから`SHUTDOWNコマンド`を実行する。

|コマンド|説明|既存の接続の扱い|実行中のSQLの扱い|
|:-:|:-|:-:|:-:|
|SHUTDOWN NORMAL|すべての接続が終了するまで待機し、インスタンスの停止処理を行う。オプション未指定のデフォルト。|ユーザーが接続を終了するまで待機する。|何もしない。|
|SHUTDOWN TRANSACTIONAL|実行中のトランザクションが終了されるまで待機し、インスタンスの停止処理を行う。|トランザクション終了時に切断される。|トランザクション終了を待機する。|
|SHUTDOWN IMMEDIATE|実行中の処理を取り消した上で、インスタンスの停止処理を行う。|切断される。|取り消す（ロールバック）|
|SHUTDOWN ABORT|実行中の処理に対する取り消し処理を実行せず、インスタンスを強制終了する。|切断される。|強制終了（取り消し処理を実行しない）|
||||

### 注意点
- `SHUTDOWN ABORT`はインスタンスを強制停止する。そのため、データベースファイルは整合性が撮れていない状態になる。データベースファイルの整合性は次回インスタンス起動時に自動的に回復される（インスタンスリカバリ）。
- `SHUTDOWN NORMAL`, `SHUTDOWN TRANSACTIONAL`, `SHUTDOWN IMMEDIATE`でインスタンスを停止すると、`チェックポイント`が実行され、データベースファイルは整合性がとれた状態になる。
- `SHUTDOWN ABORT`でインスタンスを強制終了することは、OSレベルでプロセスをKILLすることと同等。このため、日常の計画的なインスタンス停止で`SHUTDOWN ABORT`を使用しないようにする。